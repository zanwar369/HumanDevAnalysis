--- 
title: "Human Development Analysis"
author: "Zohaib Anwar, Lu Bin Liu, Michelle Strayer"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction


<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources

The data used for this project is downloaded from the [United Nations Development Programme - Human Development Reports website](http://hdr.undp.org/en/data). The United Nations Development Programme's (UNDP) Human Development Report Office (HDRO) compiles this data for the purpose of tracking human well being in countries around the world. This data is used extensively by the HDRO in its (near) annual Human Development Report (HDR). The report highlights human development in large part using various the human development indices (HDI), derived metrics for measuring human development which takes into account factors beyond economics. However for this project, HDI will not be a principal part of the investigation.       

According to the [Human Development Report 2019: Reader's Guide](http://hdr.undp.org/en/content/human-development-report-2019-readers-guide), the data used, at least for the 2019 HDR, is collected "from international data agencies with the mandate, resources, and expertise to collect national data on specific indicators". Based on the "Statistical Acknowledgement" section of the guide, the HDR data was aggregated by the HDRO from a large number of organizations that are reputable and specializes in the field from which the data was collected. For the 2019 HDR, these included international agencies like [the World Health Organization, the World Bank, and many others](http://hdr.undp.org/sites/default/files/2019_statistical_references.pdf). The HDRO also provides [contact information](http://hdr.undp.org/en/statistics/understanding/sources), where available, for organizations it sourced HDR data from.           

The data available for download from UNDP's website linked in the first paragraph consists of 12 different indicators of human development (plus HDI) and for each indicator, there are a number of descriptive features of that indicator for which data is available. For example, there are 9 features which fall under the `Demography` indicator, ranging from "Median age (years)" to "Young age (0-14) dependency ratio (per 100 people ages 15-64)". For each feature, a data table, if available, is provided where the columns include `HDI Rank (2018)`, `Country`, and one column for every year (i.e. `1990`) for which data is aggregated. Every column except `Country` contains numerical data. The years for which data is available falls in the range from 1990 to 2018.  

For this project, we will be examining 3 of the 12 indicators: `Inequality`, `Human Security`, and `Education`, which has 15, 7, and 19 features respectively. These features will be investigated in further detail in subsequent sections.     

Investigation showed that there are a number of issues with this data set as summarized below:

* The [Human Development Report 2019: Reader's Guide](http://hdr.undp.org/en/content/human-development-report-2019-readers-guide) note that due to data accessibility and processing methodology, there may be discrepancies in data between national and international agencies.

* While the data set contains data from 1990 to 2018, it does not consistently store data for this time frame for every feature for every indicator. For example, some features have data going back to 1990 but others only back to 2010.

* Even within the same indicator, difference features have data for different time intervals. Some features have data for each year, others every 5 years. 

* Data for some feature do not have data in even time intervals. For example, "Prison population (per 100,000 people)" has data for years 2003, 2005, 2010, 2011 etc.  

* As will be detailed in subsequent sections, the proportion of missing data is high for some countries. 

* For certain feature - country combinations, 2018 data was not available and was filled with the data from the most recent available year.

* It was not explicitly stated in the source documentation, but given that the data is collected from 1990-2018 and aggregated from numerous sources, it is possible that there lacks consistency in data collection and computation of certain metrics over time. [For instance, method of calculating the HDI is continuously being adjusted.](http://hdr.undp.org/en/humandev)


<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

In order to work with the amount of data we split the work into three separate buckets-- Human Security, education, and inequality.
We all performed similar transformations detailed below.


## INEQUALITY DATA TRANSFORMATION

The `Inequality` indicator has 15 features from years 2010 to 2018 (one column per year). However, the data table for 6 of these features were not available for download. The remaining 9 features for which data tables were available and was extracted were:

* Coefficient of Human Inequality

* Inequality-adjusted education index

* Inequality-adjusted HDI (IHDI)

* Inequality-adjusted income index

* Inequality-adjusted life expectancy index

* Inequality in education (%)^

* Inequality in income (%)^

* Inequality in life expectancy (%)

* Overall loss in HDI due to inequality (%)

^ Data for `2018` is either from 2018 or the latest year available. 

Note that the column 'HDI Rank (2018)' is kept as a reference column and not for analysis. 

First read all files:

```{r}
library(dplyr)
library(tidyverse)
library(readxl)
library(readr)
library(stringr)
```

```{r warning = FALSE,  message = FALSE, echo =TRUE}
temp <- list.files(path = "./Inequality/inequality_rawdata", pattern="*.csv")
 
inequality_list <- list()
for(i in 1:length(temp)){
  inequality_list[[i]] <- read_csv(paste0("./Inequality/inequality_rawdata/", temp[i]), skip = 1) %>%
                    select("HDI Rank (2018)", Country, `2010`, `2011`, `2012`, `2013`, 
                           `2014`, `2015`, `2016`, `2017`, `2018`) 
}
names(inequality_list) <- sub("\\..*", "", temp)
```

Now to take a high level look at the data itself, print the head and tail of the sixth data frame in the list `inequality_list`, which contains data for the "Inequality in education (%)" as a sample:

```{r}
print(head(inequality_list[[6]]))
print(tail(inequality_list[[6]]))
```

Inspection of the remaining data frame indicate that the last rows for every data frame in `inequality_list` are `NA`. In addition, some data frames have foot notes at the end of the table that was read in as a value in the first column. These rows are removed. 

```{r}
inequality_list[[1]] <- inequality_list[[1]] %>% 
                            filter(row_number() <= n()-1)
inequality_list[[2]] <- inequality_list[[2]] %>% 
                            filter(row_number() <= n()-1)
inequality_list[[3]] <- inequality_list[[3]] %>% 
                            filter(row_number() <= n()-1)
inequality_list[[4]] <- inequality_list[[4]] %>% 
                            filter(row_number() <= n()-1)
inequality_list[[5]] <- inequality_list[[5]] %>% 
                            filter(row_number() <= n()-1)
inequality_list[[6]] <- inequality_list[[6]] %>% 
                            filter(row_number() <= n()-3)
inequality_list[[7]] <- inequality_list[[7]] %>% 
                            filter(row_number() <= n()-3)
inequality_list[[8]] <- inequality_list[[8]] %>% 
                            filter(row_number() <= n()-2)
inequality_list[[9]] <- inequality_list[[9]] %>% 
                            filter(row_number() <= n()-1)
```

The below shows that the number of rows in the data frame for each feature is different. This implies not every feature has the same list of countries. 


```{r warning = FALSE,  message = FALSE}
for(i in 1:length(inequality_list)){
  row <- dim(inequality_list[[i]])[1]
  column <- dim(inequality_list[[i]])[2]
  print(paste0(sub("\\..*", "", temp[i])," feature has ", row, " rows and ", column, " columns."))
}
```
To investigate this further:

```{r, message = FALSE, warning = FALSE}
differences <- c()
for(i in 1:length(inequality_list)){
  for(j in 1:length(inequality_list)){
    differences <- c(differences,setdiff(inequality_list[[i]]$Country, inequality_list[[j]]$Country))
  }
}
print(unique(differences))
```
It looks like these four countries shows up for some features and not others. We can expect a lot of missing data for at least these four countries. 

The next step is to create a single tidy data frames for `Inequality`. Each data frame in `inequality_list` has column headings 2010 to 2018 which are values not variables. In addition, each data frame in `inequality_list` is from the same observational unit (`Inequality`) and should be in one data frame. To convert the list of data frames `inequality_list` into a single tidy data frame, use `pivot_longer` and `full_join` to create the tidy data frame `inequality_df`.   

```{r, echo=FALSE}
inequality_df <- inequality_list[[1]] %>% 
                    pivot_longer(!c('HDI Rank (2018)', 'Country'), 
                                 names_to = "Year", 
                                 values_to = names(inequality_list[1]))
for(i in 2:length(inequality_list)){
  temp_df <- inequality_list[[i]] %>% 
                    pivot_longer(!c('HDI Rank (2018)', 'Country'), 
                                 names_to = "Year", 
                                 values_to = names(inequality_list[i]))
  inequality_df <- inequality_df %>%
                      full_join(temp_df %>% select(-'HDI Rank (2018)'), 
                                by = c('Country','Year'))
}
head(inequality_df)
```

Note that the columns of `inequality_df` are currently all of type `<chr>` when only `Country` should be of type `<chr>`, `Year` should be of type integer, and the remaining be of type numeric.  This is because missing values are given as '..' instead of `NA`.  Convert the relevant columns to numeric which coerces '..' to `NA`'s in the process.  

```{r warning = FALSE}
inequality_df[,4:12] <- as.data.frame(sapply(inequality_df[,4:12], as.numeric))
inequality_df$Year <- as.integer(inequality_df$Year)
head(inequality_df)
```

To complete the data transformation, notice that under `Country`, the last 17 rows of each data frame contain aggregate data regional data, and are not countries: 

```{r}
tail(inequality_list[[1]]$Country,17)
```
Therefore, they will be removed from `inequality_df`.

```{r}
not_countries <- tail(inequality_list[[1]]$Country,17)
 
inequality_df <- inequality_df %>% 
  filter(!(Country %in% not_countries))
```

The head and tail of the tidy data frame is:

```{r}
head(inequality_df)
tail(inequality_df)
inequality_df %>% write_csv('./Inequality/inequality_tidy.csv')
```


## Human Security Data Transformation


Below is the code required to compose and organize the Human Security dataset.

Transforming this data largely required reorganizing the dataframe into a tidy
format.  A great number of data values are missing, discussed below.  Converting
the data from its .csv file into a workable R dataframe required removing 
blank columns (which had been left in the Excel files for visual appeal) and 
renaming columns to prime them for the pivot_longer function.  Further, to 
avoid losing data when merging the Human Security variable datasets (Homeless-
ness from natural disasters, Homicide rate, Prison population, Refugees by 
country of origin, Suicide rate for males, and Suicide rate for females), the 
all.x and all.y conditions were specified.  Then, to ensure that all missing
data were coded appropriately, a for loop was introduced to convert all numeric
data columns in the dataset into numeric type.  The result is a tidy dataset of 
all Human Security variables.



```{r}


Homeless.natural.disaster <- read.csv("./HumanSecurity/Homeless.natural.disaster.csv")
Homicide.rate <- read.csv("./HumanSecurity/Homicide.rate.csv")
Prison.popn <- read.csv("./HumanSecurity/Prison.population.csv")
Refugees <- read.csv("./HumanSecurity/Refugees.csv")
Suicide.rate.M <- read.csv("./HumanSecurity/Suicide.rate.M.csv")
Suicide.rate.F <- read.csv("./HumanSecurity/Suicide.rate.F.csv")

names(Homeless.natural.disaster)[2:30] <- c("1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018")
dcol <- 2
for (i in 2:ncol(Homeless.natural.disaster)) {
  Homeless.natural.disaster[,dcol] <- as.numeric(Homeless.natural.disaster[,dcol])
  dcol <- dcol +1
}

Homicide.rate <- subset(Homicide.rate, select = -c(X, X.1, X.2, X.3, X.4, X.5, X.6, X.7, X.8, X.9, X.10))
names(Homicide.rate)[2:13] <- c("1990", "1995", "2000", "2005", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
dcol <- 2
for (i in 2:ncol(Homicide.rate)) {
  Homicide.rate[,dcol] <- as.numeric(Homicide.rate[,dcol])
  dcol <- dcol +1
}

Prison.popn <- subset(Prison.popn, select = -c(X, X.1, X.2, X.3, X.4, X.5, X.6, X.7, X.8, X.9))
names(Prison.popn)[2:11] <- c("2003", "2005", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
dcol <- 2
for (i in 1:ncol(Prison.popn)) {
  Prison.popn[,dcol] <- as.numeric(Prison.popn[,dcol])
  dcol <- dcol +1
}

Refugees <- subset(Refugees, select = -c(X, X.1, X.2, X.3, X.4, X.5, X.6, X.7, X.8, X.9))
names(Refugees)[2:11] <- c("2003", "2005", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
dcol <- 2
for (i in 1:ncol(Refugees)) {
  Refugees[,dcol] <- as.numeric(Refugees[,dcol])
  dcol <- dcol +1
}

Suicide.rate.F <- subset(Suicide.rate.F, select = -c(X, X.1, X.2))
names(Suicide.rate.F)[2:5] <- c("2000", "2010", "2015", "2016")
dcol <- 2
for (i in 2:ncol(Suicide.rate.F)) {
  Suicide.rate.F[,dcol] <- as.numeric(Suicide.rate.F[,dcol])
  dcol <- dcol +1
}

Suicide.rate.M <- subset(Suicide.rate.M, select = -c(X, X.1, X.2))
names(Suicide.rate.M)[2:5] <- c("2000", "2010", "2015", "2016")
dcol <- 2
for (i in 2:ncol(Suicide.rate.M)) {
  Suicide.rate.M[,dcol] <- as.numeric(Suicide.rate.M[,dcol])
  dcol <- dcol +1
}

HND <- pivot_longer(Homeless.natural.disaster, cols = !Country, names_to = "Year", values_to = "Homeless.ND")
HR <- pivot_longer(Homicide.rate, cols = !Country, names_to = "Year", values_to = "Homicide.rate")
PP <- pivot_longer(Prison.popn, cols = !Country, names_to = "Year", values_to = "Prison.popn")
R <- pivot_longer(Refugees, cols = !Country, names_to = "Year", values_to = "Refugees")
SRF <- pivot_longer(Suicide.rate.F, cols = !Country, names_to = "Year", values_to = "Suicide.rate.F")
SRM <- pivot_longer(Suicide.rate.M, cols = !Country, names_to = "Year", values_to = "Suicide.rate.M")
Human.Security <- merge(HND, HR, all.x = T, all.y = T)
Human.Security <- merge(Human.Security, PP, all.x = T, all.y = T)
Human.Security <- merge(Human.Security, R, all.x = T, all.y = T)
Human.Security <- merge(Human.Security, SRF, all.x = T, all.y = T)  
Human.Security <- merge(Human.Security, SRM, all.x = T, all.y = T)
Human.Security <- Human.Security[30:5684,]
```



## Education Data Transformation


In order to read in the education data-- I first take in every file in the relevant Education directory. With this data I determine the relevant NAs in the files, and code those as NAs. Similarly I skip the first line in the file which are blank. Then I remove any rows that are irrelevant-- specifically the rows with footnotes. Finally I remove additional columns, and change data types if necessary, and am then ready to transform the data itself.

```{r,echo=TRUE}

dr="./Education/csv"
file_list <- list.files(path=dr,pattern="*.csv")
dttyp<-c("EdInd","ExpSch","ExpSchF","ExpSchM","GovMon","GERPP","GERP","GERS","GERT",
         "LitR","MYSch","MYSchF","MYSchM","PerPSInt","PerSSInt","PopSSF25U","PopSSM25U",
         "PSDrop","PSTchTrn","PISAMth","PISARead","PISAScn","PupTchRPS","SurvRSGE")

for (i in 1:length(file_list)){
   df_temp<-read.csv(paste(dr,"/",file_list[i],sep=""),skip=1,header=T, 
                      check.names = F,na.strings=c("..",""," ","<NA>"))
   df_temp<-subset(df_temp,!grepl("[a-z]:",df_temp$`HDI Rank (2018)`))
   df_temp$`HDI Rank (2018)`<-as.numeric(df_temp$`HDI Rank (2018)`)
   df_temp$var<-dttyp[i]
   if (i==1) {
     df_ed<-df_temp[!sapply(df_temp, function(x) all(is.na(x)))]}
   else {df_ed<-bind_rows(df_ed,df_temp[!sapply(df_temp, function(x) all(is.na(x)))])}
   
}
df_ed<-df_ed[,!grepl("\\.[0-9]",colnames(df_ed))]
```

Once the files are read in correctly I create two separate forms of the data. One with each variable as a column, and year as its own signular column using pivot longer, and wider, and one where the relevant education vartiables are also in a singular column. While the seconde format is not necessarily tidy this will help look at missings across the data.

```{r,echo=TRUE}
df_ed_lg<-df_ed %>%
            pivot_longer(cols=!c("HDI Rank (2018)","Country","var"),names_to="Year",values_to="HDI") 
df_ed_td<-df_ed_lg %>%
            pivot_wider(names_from="var",values_from="HDI")
```


<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

```{r}
library(tidyverse)
library(readxl)
library(readr)
library(stringr)
library(ggplot2)
library(GGally)
```

### INEQUALITY MISSING DATA


```{r  warning = FALSE,  message = FALSE} 
inequality_df <- read_csv("./Inequality/inequality_tidy.csv")
```

Below is a bar plot showing the count of missing data per feature.

```{r fig.width = 8}
prop_missing_features <- data.frame(var = names(colMeans(is.na(inequality_df))), 
            prop_missing = unname(colMeans(is.na(inequality_df)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip()
```


The above shows that for 7 of the 9 features, 20-25% of its entries are missing.

Since there is only 9 years and 9 features, a heat map is an appropriate to visualize combinations of missing data between `Year` and the different features to see if there's any relationship in proportion of missing data for a specific feature across years (and vice versa). 

```{r fig.height = 6, fig.width = 8}

prop_missing_year<- inequality_df %>% 
  group_by(Year) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Country, -'HDI Rank (2018)') %>% 
  pivot_longer(-Year, names_to = 'features' , values_to = 'year_prop_missing') 

prop_missing_year%>%
  ggplot(aes(x = factor(Year), y = fct_reorder(features, -year_prop_missing, mean))) +
  geom_tile(aes(fill = year_prop_missing)) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")
  
```


The above heat map is drawn such that the feature with the largest proportion of missing data is at the bottom. From the heat map, it looks like 2011 and 2012 have the highest rates of missing data for every features aside from "Inequality in life expectancy (%)" and "Inequality-adjusted life expectancy index". However, note that the proportion of missing data peaks at around 0.3 and most feature-year combinations have proportion of missing data that are below 0.2, which are manageable.  

The below is the aggregate sum of number of missing entries over all features for each country, filtering only the countries with at least one missing entry.  

```{r fig.height = 12, fig.width = 8}

prop_missing_countries<- inequality_df %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup()

prop_missing_countries <- data.frame(Country = prop_missing_countries$Country, 
                                     country_prop_missing =  rowMeans(prop_missing_countries[,4:12])) %>% 
                          filter(country_prop_missing > 0) 

prop_missing_countries %>% 
    ggplot(aes(x = fct_reorder(Country, country_prop_missing, .desc =FALSE), y = country_prop_missing)) +
    geom_col() +
    coord_flip()
```


It looks like 100% of the data is missing for Saint Kitts and Nevis, Liechtenstein, and Dominica. In addition, >87.5% of the data is missing for Nauru, Marshall Islands, Andorra, and Tuvalu. All of these countries are extremely small (most are islands) and it is possible that `Inequality` data is not collected nationally and/or data collection is not prioritized by the relevant international organizations.  


Due to the large volume of countries, a heat map is not an effective way to visualize the relationship in proportion of data missing between countries and features. A parallel coordinate plot was drawn instead to determine if there's any relationship between features and proportion of missing data for different countries.

```{r, fig.height = 8, fig.width=8}

inequality_df[,c(1,2,3,4,12,6, 7,10, 5, 9, 11, 8)] %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Year, -'HDI Rank (2018)', -Country) %>%
  ggparcoord(alpha = 0.2,
             scale = 'globalminmax',
             splineFactor = 0)  +
  theme(axis.text.x = element_text(angle = 90))

```


* Most countries appear to not be missing data for "Inequality-adjusted life expectancy index" and "Inequality in life expectancy (%)"  

* For remaining features, at intervals of around 0.1 from 0 to 1, there are clusters of countries missing that proportion of data for each feature. 

* There is a small number of countries missing data for most to all of the features (flat line at the top), these are likely the smaller countries found in the bar charts.

* For "Coefficient of Human Inequality", "Inequality-adjusted HDI (IHDI)", and "Inequality-adjusted HDI (IDHI)", countries generally miss the same proportion of the data for all 3 features, indicating that they may be related. 

* For "Inequality-adjusted income index" and "Inequality in income (%)", countries generally miss the same proportion of the data for these two features; they are likely related. In addition, countries generally are missing an equal to or smaller proportion of data for these two features than the 3 features mentioned in the previous bullet. 

* For "Inequality-adjusted education index" and "Inequality in education (%)" countries generally miss the same proportion of the data for these two features; they are likely related.



### Human Security Missing Data

A significant proportion of data in the Human.Security dataframe is missing.
Largely, this seems to be the product of uneven variable tracking.  Homelessness
due to natural disasters seems to be tracked in most countries on a yearly
basis between 1990 and 2018.  By contrast, Homicide rate was recorded only in 
1990, 1995, 2000, 2005, and yearly from 2010 to 2017.  As another exmaple, 
suicide rate for both males and females were recorded only in the years 2000, 
2010, 2015, and 2016.

```{r}
Homeless.natural.disaster <- read.csv("./HumanSecurity/Homeless.tidy.csv")
Homicide.rate <- read.csv("./HumanSecurity/Homicide.tidy.csv")
Suicide.rate.F <- read.csv("./HumanSecurity/SR.F.tidy.csv")
Suicide.rate.M <- read.csv("./HumanSecurity/SR.M.tidy.csv")
colnames(Homeless.natural.disaster)[2:30]
```
```{r}
colnames(Homicide.rate)[2:13]
```
```{r}
colnames(Suicide.rate.F)[2:5]
colnames(Suicide.rate.M)[2:5]
```


Importantly, data also appears to be missing among outlying island countries and
countries in the African continent.  For example, the chart below notes missing 
Homicide data.

A notable chunk of countries (obs. numbers 50-100) seem to be missing data
between 1990 and 2005.  However, the largest amount of missing data seems to 
be concentrated in observations 150 to 192, which includes Mironesia and many of
the countries on and around the African continent (ie. Nigeria, Sudan, Senegal).


```{r}
x <- missing_data.frame(Homicide.rate)
image(x)
```

This trend is not unknown in international data collection.  Lower 
infrastructural development renders data collection difficult, and factors like 
human rights and humanitarian crises, political violence, and political 
instability can hinder data collection processes. 







###EDUCATION MISSING DATA

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

