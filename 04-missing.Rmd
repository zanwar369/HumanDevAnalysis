# Missing values

```{r, warning=FALSE,message=FALSE}
library(tidyverse)
library(readxl)
library(readr)
library(stringr)
library(ggplot2)
library(GGally)
library(mi)
```

## Inequality Missing Data


```{r  warning = FALSE,  message = FALSE} 
inequality_df <- read_csv("./Inequality/inequality_tidy.csv")
```

Below is a bar plot showing the count of missing data per feature.

```{r fig.width = 8}
prop_missing_features <- data.frame(var = names(colMeans(is.na(inequality_df))), 
            prop_missing = unname(colMeans(is.na(inequality_df)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip()
```


The above shows that for 7 of the 9 features, 20-25% of its entries are missing.

Since there is only 9 years and 9 features, a heat map is an appropriate to visualize combinations of missing data between `Year` and the different features to see if there's any relationship in proportion of missing data for a specific feature across years (and vice versa). 

```{r fig.height = 6, fig.width = 8}

prop_missing_year<- inequality_df %>% 
  group_by(Year) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Country, -'HDI Rank (2018)') %>% 
  pivot_longer(-Year, names_to = 'features' , values_to = 'year_prop_missing') 

prop_missing_year%>%
  ggplot(aes(x = factor(Year), y = fct_reorder(features, -year_prop_missing, mean))) +
  geom_tile(aes(fill = year_prop_missing)) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")
  
```


The above heat map is drawn such that the feature with the largest proportion of missing data is at the bottom. From the heat map, it looks like 2011 and 2012 have the highest rates of missing data for every features aside from "Inequality in life expectancy (%)" and "Inequality-adjusted life expectancy index". However, note that the proportion of missing data peaks at around 0.3 and most feature-year combinations have proportion of missing data that are below 0.2, which are manageable.  

The below is the aggregate sum of number of missing entries over all features for each country, filtering only the countries with at least one missing entry.  

```{r fig.height = 12, fig.width = 8}

prop_missing_countries<- inequality_df %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup()

prop_missing_countries <- data.frame(Country = prop_missing_countries$Country, 
                                     country_prop_missing =  rowMeans(prop_missing_countries[,4:12])) %>% 
                          filter(country_prop_missing > 0) 

prop_missing_countries %>% 
    ggplot(aes(x = fct_reorder(Country, country_prop_missing, .desc =FALSE), y = country_prop_missing)) +
    geom_col() +
    coord_flip()
```


It looks like 100% of the data is missing for Saint Kitts and Nevis, Liechtenstein, and Dominica. In addition, >87.5% of the data is missing for Nauru, Marshall Islands, Andorra, and Tuvalu. All of these countries are extremely small (most are islands) and it is possible that `Inequality` data is not collected nationally and/or data collection is not prioritized by the relevant international organizations.  


Due to the large volume of countries, a heat map is not an effective way to visualize the relationship in proportion of data missing between countries and features. A parallel coordinate plot was drawn instead to determine if there's any relationship between features and proportion of missing data for different countries.

```{r, fig.height = 8, fig.width=8}

inequality_df[,c(1,2,3,4,12,6, 7,10, 5, 9, 11, 8)] %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Year, -'HDI Rank (2018)', -Country) %>%
  ggparcoord(alpha = 0.2,
             scale = 'globalminmax',
             splineFactor = 0)  +
  theme(axis.text.x = element_text(angle = 90))

```


* Most countries appear to not be missing data for "Inequality-adjusted life expectancy index" and "Inequality in life expectancy (%)"  

* For remaining features, at intervals of around 0.1 from 0 to 1, there are clusters of countries missing that proportion of data for each feature. 

* There is a small number of countries missing data for most to all of the features (flat line at the top), these are likely the smaller countries found in the bar charts.

* For "Coefficient of Human Inequality", "Inequality-adjusted HDI (IHDI)", and "Inequality-adjusted HDI (IDHI)", countries generally miss the same proportion of the data for all 3 features, indicating that they may be related. 

* For "Inequality-adjusted income index" and "Inequality in income (%)", countries generally miss the same proportion of the data for these two features; they are likely related. In addition, countries generally are missing an equal to or smaller proportion of data for these two features than the 3 features mentioned in the previous bullet. 

* For "Inequality-adjusted education index" and "Inequality in education (%)" countries generally miss the same proportion of the data for these two features; they are likely related.



## Human Security Missing Data

A significant proportion of data in the Human.Security dataframe is missing.
Largely, this seems to be the product of uneven variable tracking.  Homelessness
due to natural disasters seems to be tracked in most countries on a yearly
basis between 1990 and 2018.  By contrast, Homicide rate was recorded only in 
1990, 1995, 2000, 2005, and yearly from 2010 to 2017.  As another exmaple, 
suicide rate for both males and females were recorded only in the years 2000, 
2010, 2015, and 2016.


```{r}
Human.Security <- read.csv("./HumanSecurity/Human.Security.csv")
Human.Security.2 <- read.csv("./HumanSecurity/Human.Security.2.csv")
Homeless.natural.disaster <- read.csv("./HumanSecurity/Homeless.tidy.csv")
Homicide.rate <- read.csv("./HumanSecurity/Homicide.tidy.csv")
rownames(Homicide.rate) <- Homicide.rate$Country
Homicide.rate <- Homicide.rate[,3:14]
Suicide.rate.F <- read.csv("./HumanSecurity/SR.F.tidy.csv")
Suicide.rate.M <- read.csv("./HumanSecurity/SR.M.tidy.csv")
colnames(Homeless.natural.disaster)[3:31]
```


```{r}
colnames(Homicide.rate)[1:12]
```

```{r}
colnames(Suicide.rate.F)[3:6]
colnames(Suicide.rate.M)[3:6]
```


```{r}
prop_missing_features <- data.frame(var = names(colMeans(is.na(Human.Security))), 
            prop_missing = unname(colMeans(is.na(Human.Security)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip() 
```
```{r}
prop_missing_features <- data.frame(var = names(colMeans(is.na(Human.Security.2))), 
            prop_missing = unname(colMeans(is.na(Human.Security.2)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip() 
```




Importantly, data also appears to be missing among outlying island countries and
countries in the African continent.  For example, the chart below notes missing 
Homicide data.

A notable chunk of countries (obs. numbers 50-100) seem to be missing data
between 1990 and 2005.  However, the largest amount of missing data seems to 
be concentrated in observations 150 to 192, which includes Micronesia and many of
the countries on and around the African continent (ie. Nigeria, Sudan, Senegal).


```{r}
x <- missing_data.frame(Homicide.rate)
image(x)
```

This trend is not unknown in international data collection.  Lower 
infrastructural development renders data collection difficult, and factors like 
human rights and humanitarian crises, political violence, and political 
instability can hinder data collection processes. 


```{r fig.height = 16, fig.width = 8}

prop_missing_countries<- Human.Security.2 %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup()

prop_missing_countries <- data.frame(Country = prop_missing_countries$Country, 
                                     country_prop_missing =  rowMeans(prop_missing_countries[,2:8])) %>% 
                          filter(country_prop_missing > .3)

prop_missing_countries %>% 
    ggplot(aes(x = fct_reorder(Country, country_prop_missing, .desc =FALSE), y = country_prop_missing)) +
    geom_col() +
    coord_flip()
```



## Education Missing Data


```{r warning = FALSE,  message = FALSE}

df_ed_td<-read_csv('./Education/Education_Tidy.csv')
df_ed_lg<-read_csv('./Education/Education_LG.csv')
df<-df_ed_td[c(2,4:28)] %>% group_by(Country) %>% select(everything()) %>%
     summarise_all(funs(sum(is.na(.)))) 
df$TotalMiss<-rowSums(df[,2:26])

```


There are `r sum(df$TotalMiss)` missing observations across the variables, year and country. The following bar chart displaying an interesting yet confusing pattern. It looks like all countries have between `r min(df$TotalMiss)` and  `r max(df$TotalMiss)`. Keeping in mind the data spans 29 years, and 25 variables, this is sensible, though there doesn't seem to be much of a pttern to missing observations, though smaller countries seem partially more likely to have missing data.

```{r,fig.height=25,fig.width=10}
ggplot(df,aes(y=fct_reorder(Country,TotalMiss),x=TotalMiss)) +
geom_col()+ylab("Country")+xlab("")+ggtitle("Total Missing") +
  theme(plot.title = element_text(hjust = 0.5))
```


For this analysis we want the variables with the least missing values across Countries to have a complete analysis. Overall it looks like, we can already begin narrowing down some of our variables to the ones that have almost no missings across all countries such as education index, or mean years of schooling. Other interesting notes are that the formerYugoslav Republic of Macedonia seems to have all missing observations-- which is correct according to the original source data, and after a little digging is because it has been replaced by North Macedonia, and is likely a left over. Percent of students without access to internet seems to be reported by very few, and mostly developed countries. The percent of population with at least some secondary education also seems like a variable that is frequently reported.

```{r,fig.height=25,fig.width=20}

ggplot(df[,1:26] %>%
     pivot_longer(cols=!c("Country"),names_to="Vari",values_to="Val") ,aes(y=Country,x=Vari,fill=Val))+
  geom_tile()+xlab("Variable")+ggtitle("Missing by variable and Country")+them(plot.title = element_text(hjust = 0.5))

```


Breaking down the analysis a little further, it looks we should definitely focus on 2010 onwards gfiving the lack of data across countries on a consistent basis for singular years beforehand. It looks like the data was previously released in 5-year buckets.

```{r,fig.height=25,fig.width=20}

df<-df_ed_lg %>% pivot_wider(names_from="Year",values_from="HDI")
df_n<-df[c(2,4:32)] %>% group_by(Country) %>% select(everything()) %>%
     summarise_all(funs(sum(is.na(.)))) 
ggplot(df_n %>%
     pivot_longer(cols=!c("Country"),names_to="Year",values_to="Val") ,aes(y=Country,x=Year,fill=Val))+
  geom_tile()+xlab("Year")+ggtitle("Missing by Year")+theme(plot.title = element_text(hjust = 0.5))

```

Interestingly breakding down the missing variables by year confirms what was seen previously. The most reliable variables will be Education Index, Mean Years of Schooling, and Expected Years of Schooling, according to the lower number of missings throughout the years, as well as population with some secondary education.

```{r,fig.height=25,fig.width=20}
df<-df_ed_td[c(3:28)] %>% group_by(Year) %>% select(everything()) %>%
     summarise_all(funs(sum(is.na(.)))) 
df$Year<-factor(df$Year)
ggplot(df %>%
     pivot_longer(cols=!c("Year"),names_to="Variable",values_to="Val") ,aes(y=Year,x=Variable,fill=Val))+
  geom_tile()+xlab("Variable")+ylab("Year")+ggtitle("Missing by Year and Variable")+
  theme(plot.title = element_text(hjust = 0.5))

```
