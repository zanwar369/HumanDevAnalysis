# Missing values

```{r}
library(tidyverse)
library(readxl)
library(readr)
library(stringr)
library(ggplot2)
library(GGally)
library(mi)
```

## Inequality Missing Data


```{r  warning = FALSE,  message = FALSE} 
inequality_df <- read_csv("./Inequality/inequality_tidy.csv")
```

Below is a bar plot showing the count of missing data per feature.

```{r fig.width = 8}
prop_missing_features <- data.frame(var = names(colMeans(is.na(inequality_df))), 
            prop_missing = unname(colMeans(is.na(inequality_df)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip()
```


The above shows that for 7 of the 9 features, 20-25% of its entries are missing.

Since there is only 9 years and 9 features, a heat map is an appropriate to visualize combinations of missing data between `Year` and the different features to see if there's any relationship in proportion of missing data for a specific feature across years (and vice versa). 

```{r fig.height = 6, fig.width = 8}

prop_missing_year<- inequality_df %>% 
  group_by(Year) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Country, -'HDI Rank (2018)') %>% 
  pivot_longer(-Year, names_to = 'features' , values_to = 'year_prop_missing') 

prop_missing_year%>%
  ggplot(aes(x = factor(Year), y = fct_reorder(features, -year_prop_missing, mean))) +
  geom_tile(aes(fill = year_prop_missing)) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7")
  
```


The above heat map is drawn such that the feature with the largest proportion of missing data is at the bottom. From the heat map, it looks like 2011 and 2012 have the highest rates of missing data for every features aside from "Inequality in life expectancy (%)" and "Inequality-adjusted life expectancy index". However, note that the proportion of missing data peaks at around 0.3 and most feature-year combinations have proportion of missing data that are below 0.2, which are manageable.  

The below is the aggregate sum of number of missing entries over all features for each country, filtering only the countries with at least one missing entry.  

```{r fig.height = 12, fig.width = 8}

prop_missing_countries<- inequality_df %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup()

prop_missing_countries <- data.frame(Country = prop_missing_countries$Country, 
                                     country_prop_missing =  rowMeans(prop_missing_countries[,4:12])) %>% 
                          filter(country_prop_missing > 0) 

prop_missing_countries %>% 
    ggplot(aes(x = fct_reorder(Country, country_prop_missing, .desc =FALSE), y = country_prop_missing)) +
    geom_col() +
    coord_flip()
```


It looks like 100% of the data is missing for Saint Kitts and Nevis, Liechtenstein, and Dominica. In addition, >87.5% of the data is missing for Nauru, Marshall Islands, Andorra, and Tuvalu. All of these countries are extremely small (most are islands) and it is possible that `Inequality` data is not collected nationally and/or data collection is not prioritized by the relevant international organizations.  


Due to the large volume of countries, a heat map is not an effective way to visualize the relationship in proportion of data missing between countries and features. A parallel coordinate plot was drawn instead to determine if there's any relationship between features and proportion of missing data for different countries.

```{r, fig.height = 8, fig.width=8}

inequality_df[,c(1,2,3,4,12,6, 7,10, 5, 9, 11, 8)] %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Year, -'HDI Rank (2018)', -Country) %>%
  ggparcoord(alpha = 0.2,
             scale = 'globalminmax',
             splineFactor = 0)  +
  theme(axis.text.x = element_text(angle = 90))

```


* Most countries appear to not be missing data for "Inequality-adjusted life expectancy index" and "Inequality in life expectancy (%)"  

* For remaining features, at intervals of around 0.1 from 0 to 1, there are clusters of countries missing that proportion of data for each feature. 

* There is a small number of countries missing data for most to all of the features (flat line at the top), these are likely the smaller countries found in the bar charts.

* For "Coefficient of Human Inequality", "Inequality-adjusted HDI (IHDI)", and "Inequality-adjusted HDI (IDHI)", countries generally miss the same proportion of the data for all 3 features, indicating that they may be related. 

* For "Inequality-adjusted income index" and "Inequality in income (%)", countries generally miss the same proportion of the data for these two features; they are likely related. In addition, countries generally are missing an equal to or smaller proportion of data for these two features than the 3 features mentioned in the previous bullet. 

* For "Inequality-adjusted education index" and "Inequality in education (%)" countries generally miss the same proportion of the data for these two features; they are likely related.



## Human Security Missing Data

A significant proportion of data in the Human.Security dataframe is missing.  Largely, this seems to be a product of well-documented geographical complications in collecting political science data and uneven tracking between variables.

```{r, echo=F}
Human.Security <- read_csv("./HumanSecurity/Human.Security.csv")
Human.Security <- Human.Security[,2:9]
Human.Security.2 <- read_csv("./HumanSecurity/Human.Security.2.csv")
Human.Security.2 <- Human.Security.2[,2:9]
Homeless.natural.disaster <- read_csv("./HumanSecurity/Homeless.tidy.csv")
Homeless.natural.disaster <- Homeless.natural.disaster[,2:31]
Homicide.rate <- read_csv("./HumanSecurity/Homicide.tidy.csv")
Homicide.rate <- Homicide.rate[,2:14]
Homicide.rate.1 <- read.csv("./HumanSecurity/Homicide.tidy.csv")
Homicide.rate.1 <- Homicide.rate.1[,2:14]
names(Homicide.rate.1)[2:13] <- c("1990", "1995", "2000", "2005", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
Suicide.rate.F <- read_csv("./HumanSecurity/SR.F.tidy.csv")
Suicide.rate.F <- Suicide.rate.F[,2:6]
Suicide.rate.M <- read_csv("./HumanSecurity/SR.M.tidy.csv")
Suicide.rate.M <- Suicide.rate.M[,2:6]
```


A number of unique problems are incurred in the collection of international political science data, as discussed previously in the Data chapter. Certain countries present unique challenges for data collection, particularly where collection processes rely on state institutions and infrastructure.

The Homicide dataset is a particularly demonstrative example.  The final entries in the dataset show countries for which there is no recorded homicide data.

These countries are:

```{r, echo = F}
print(Homicide.rate$Country[168:192])
```

Of these 24 countries, 20 (CÃ³te d'Ivoire, Congo, Djibouti, Ethiopia, Gabon, Gambia, Madagascar, Mali, Nigeria, Sudan, Chad, Congo [Dem. Republic], Comoros, Eritrea, Guinea, Equatorial Guinea, Libya, Mauritania, Senegal, and Togo) are in Africa.  The remaining four (Lao [People's Dem. Republic], Vanuatu, Micronesia [Fed. States], the Marshall Islands, and Palau) are small island countries in Oceania.


```{r fig.height = 14, fig.width = 8}

prop_missing_countries<- Human.Security.2 %>% 
  group_by(Country) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup()

prop_missing_countries <- data.frame(Country = prop_missing_countries$Country, 
                                     country_prop_missing =  rowMeans(prop_missing_countries[,2:8])) %>% 
                          filter(country_prop_missing > .1)

prop_missing_countries %>% 
    ggplot(aes(x = fct_reorder(Country, country_prop_missing, .desc =FALSE), y = country_prop_missing)) +
    geom_col() +
    coord_flip() + 
    xlab(NULL) + 
    ylab("Proportion of Data Missing") +
    ggtitle("Missing Human Security Data by Country")
```

The above graph shows the proportion of missing data in the compiled Human Security dataset.  The Marshall Islands (Oceania) is missing over 90%, with Palau (Oceania) missing over 65% and Somalia (Africa), Korea (Dem. People's Rep.) [North Korea] (Asia), and St. Kitts and Nevis (Oceania) each missing over 50% of data.

The countries missing 40% or more data include the above, as well as Andorra (Europe), Eritrea (Africa), Iran [Islamic Rep.] (Asia), Mali (Africa), Micronesia [Fed. States] (Oceania), Palestine (Asia), Congo (Africa), Gambia (Africa), and Sudan (Africa).

Of these states, four are within Oceania, six in Africa, three in Asia (Korea (Dem. People's Rep.) [North Korea], Iran (Islamic Rep.), and Palestine), and one is in Europe (Andorra).

Due to the large volume of countries included in this data, and their alphabetical organizational scheme, a heatmap is not an appropriate visualization tool.  


Further, the dataset shows uneven tracking between variables.  Homelessness due to natural disaster is measured on a yearly basis between 1990 and 2018.  By contrast, Homicide rate was recorded only in 1990, 1995, 2000, 2005, and yearly from 2010 to 2017.  As another example, suicide rate for both males and females were recorded only in the years 2000, 2010, 2015, and 2016.

Below are the years in the Homeless.natural.disaster dataset for which data were collected:


```{r, echo=F}
colnames(Homeless.natural.disaster)[2:30]
```

By contrast, homicide data were only collected for the following years:

```{r,echo=F}
colnames(Homicide.rate)[2:13]
```

And suicide rate data for both male and females were only collected in the following years:

```{r, echo=F}
colnames(Suicide.rate.F)[2:5]
```

The large difference in frequency of data collection between these datasets results in a merged dataset with a great deal of missing values.  As the following graph demonstrates, as a result of the Homeless.natural.disaster data, remaining variables are each missing a minimum of about 75% of data values. 

```{r, echo=F}
prop_missing_features <- data.frame(var = names(colMeans(is.na(Human.Security))), 
            prop_missing = unname(colMeans(is.na(Human.Security)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip() +
    xlab(NULL) + 
    ylab("Proportion of Data Missing") +
    ggtitle("Missing Data", subtitle = "Including all years") + 
    ylim(c(0,.9))
```

Alternately, the graphic below gives a more accurate picture of missing data.


```{r, echo=F}
prop_missing_features <- data.frame(var = names(colMeans(is.na(Human.Security.2))), 
            prop_missing = unname(colMeans(is.na(Human.Security.2)))) %>%
          filter(prop_missing > 0)  

prop_missing_features %>%
    ggplot(aes(x = fct_reorder(var, prop_missing, .desc =FALSE), y = prop_missing)) +
    geom_col() +
    coord_flip() +
    xlab(NULL) + 
    ylab("Proportion of Data Missing") +
    ggtitle("Missing Data", subtitle = "Including only matched years") +
    ylim(c(0,.9))
```

The data reflected in this chart do not include the empty rows added to fit the years of recorded homelessness data.  The variables with the greatest proportion of missing data (Refugees and Prison population) are missing between 45% and 50% of their data.

The following heatmap shows missing data split by variable.

```{r}
prop_missing_year<- Human.Security.2 %>% 
  group_by(Year) %>% 
  summarise_all(~ sum(is.na(.))/n()) %>%
  ungroup() %>% 
  select(-Country) %>% 
  pivot_longer(-Year, names_to = 'features' , values_to = 'year_prop_missing') 

prop_missing_year%>%
  ggplot(aes(x = factor(Year), y = fct_reorder(features, -year_prop_missing, mean))) +
  geom_tile(aes(fill = year_prop_missing)) +
  scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
  xlab("Year") + 
  ylab(NULL) +
  ggtitle("Missing Human Security Data by Variable")
```

Homelessness due to natural disaster, suicide rate (both male and female), and homicide rate are missing the least amount of data, though both refugees by country of origin and prison population are missing relatively little data after the year 2000.

Given that homelessness due to natural disaster seems to be the most thoroughly recorded variable, the low proportion of missing data makes sense.  Additionally, given that suicide rate (male and female) only provides data for four years (2000, 2010, 2015, 2016), its low proportion of missing data also follows logically.  

Both refugees by country of origin and prison population show a high proportion of missing data around the year 2000, and appear to fluctuate together. Given both refugee emigration and prison population require strong infrastructure and organization to accurately compute, it seems possible that whatever institutions collect data on these factors may be impacted by similar influences.


## Education Missing Data


```{r warning = FALSE,  message = FALSE}

df_ed_td<-read_csv('./Education/Education_Tidy.csv')
df_ed_lg<-read_csv('./Education/Education_Wide.csv')

df_ed_td<-df_ed_td[!is.na(df_ed_td$`HDI Rank (2018)`),]
df_ed_lg<-df_ed_lg[!is.na(df_ed_lg$`HDI Rank (2018)`),]

```

There are 87056 missing values in the entire data frame.

```{r}
nrow(df_ed_lg[is.na(df_ed_lg$HDI),])
```

Of those most of the observations seem to concentrated before 2010, where the number of missings declined down to 1 thousand each year, until recently in 2017, and 2018, which saw gains towards 3000.
```{r}
df_ed_lg[is.na(df_ed_lg$HDI),] %>% group_by(Year) %>% count() %>% print(n=30)
```

It looks like missings arer concentrated in the smaller countries.
```{r, message=FALSE}
df_ed_lg[is.na(df_ed_lg$HDI),] %>% group_by(Country) %>% summarize(Count=n()) %>% arrange(desc(Count)) %>% print(n=250)
```
By variable it looks the number of missings varies quite a bit from 217, all the way up to >5000
```{r}
summary(df_ed_td)

```

