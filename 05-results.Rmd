# Results

## Variable Selection 


```{r,warning=FALSE,message=FALSE}

library(tidyverse)
library(readxl)
library(readr)
library(stringr)
library(ggplot2)
library(GGally)

```

### Inequality Variable Selection

From Section 4.0 Missing Data, it was noted from the parallel coordinate plot of the `Inequality` indicator that the following sets of features had the same proportion of missing data for nearly every country, indicating that they may be related: 

* "Coefficient of Human Inequality", "Overall loss in HDI due to inequality (%)", and "Inequality-adjusted HDI (IHDI)"

* "Inequality-adjusted income index" and "Inequality in income (%)"

* "Inequality-adjusted education index" and "Inequality in education (%)"

* "Inequality-adjusted life expectancy index" and "Inequality in life expectancy (%)"

A scatterplot matrix of all 9 features without the missing data is below and such that pairwise correlations between all features can be examined. The analysis will begin with the feature groups listed above with strong relationships in their missing data, then extend to the remaining feature variable pairs. 


```{r,fig.height=12, fig.width = 12, warning = FALSE ,  message = FALSE}
inequality_df <- read_csv("./Inequality/inequality_tidy.csv")
inequality_df_copy <- inequality_df
names(inequality_df_copy) <- gsub("-", " ", names(inequality_df_copy))
ggpairs(inequality_df_copy[,c(4,12,6, 7,10, 5, 9, 11, 8)], progress = FALSE,
        upper = list(continuous = wrap("cor", size = 4)),
        #lower = list(continuous = wrap('points', alpha = 0.3)),
        labeller = label_wrap_gen(10))+
      ggtitle("Pairwise Correlation Scatterplot Matrix", subtitle = 'Inequality') + 
      theme(plot.title = element_text(size = 24),
            plot.subtitle = element_text(size = 20),
            strip.text = element_text(size = 12)) 

```



First, look at the feature groups where missing data appear to be in equal proportions for most countries:

* "Coefficient of Human Inequality", "Overall loss in HDI due to inequality (%)", and "Inequality-adjusted HDI (IHDI)": The three pairwise correlation coefficients between these three features are 0.999, -0.954, and -0.950, showing that these three feature are highly correlated when the data is not missing.

* "Inequality-adjusted income index" and "Inequality in income (%)": Correlation coefficient of -0.644. Despite countries missing data for both feature consistently, the two feature do not appear to have as strong of correlation as other cases discussed. 

* "Inequality-adjusted education index" and "Inequality in education (%)": The correlation coefficient is -0.942, showing that these two feature are highly correlated when the data is not missing.

* "Inequality-adjusted life expectancy index" and "Inequality in life expectancy (%)": The correlation coefficient is -0.976, showing that these two feature are highly correlated when the data is not missing.

On the basis of the results above, the following features can be dropped without significant loss of information:

* "Overall loss in HDI due to inequality (%)" - due to strong correlation with "Coefficient of Human Inequality" and the fact both share similar missing patterns. 

* "Inequality-adjusted HDI (IHDI)" - highly correlated with multiple features, especially "Coefficient of Human Inequality" and "Overall loss in HDI due to inequality (%)" (while also sharing the same missing pattern as the latter two).

* "Inequality-adjusted education index" - highly correlated with "Inequality in education (%)" when data is present and in terms of missing pattern.  

* "Inequality-adjusted life expectancy index" - highly correlated with "Inequality in life expectancy (%)" when data is present and in terms of missing pattern.  

Looking at the pairplot of the 5 remaining variables, it is noted that even though they do not share the same missing patterns, "Coefficient of Human Inequality" is strongly correlated with 3 of the remaining features (absolute correlation coefficient of ~0.9). Therefore, this feature can also be dropped. As a result, the remaining 'Inequality' features to be kept for analysis with other indicators are:

* "Inequality-adjusted income index"

* "Inequality in income (%)"

* "Inequality in education (%)"

* "Inequality in life expectancy (%)"



### Education Variable Selection

Initially we pull only the variables that had the least missings as per the missings analysis.I then run ggpairs across these variables to determine if there is further narrrowing we can do in regards to select. Given that the variables are all relatively, highly correlated, it is decided to just take Education Index as the variable of comparion in the analysis of correlations across human development topics.

```{r warning = FALSE,  message = FALSE}

df_ed<-read_csv('./Education/Education_Tidy.csv')
df_ed<-df_ed[,c("HDI Rank (2018)","Country","Year",
        "EdInd","ExpSch","MYSch","PopSS25U")]
ggpairs(df_ed[,c("EdInd","ExpSch","MYSch","PopSS25U")])
```



Next to determine how to deal with the year variable we look at the yearly breakdown since 2010 (since the Inequality dataset only spans 2010-2018). From here we can see every single year is highly correlated (.985 to 1) hence suggesting we do not have to look at each year individually, and can aggregate across years instead with a simple average.

```{r warning = FALSE,  message = FALSE,fig.width=20}
df<-df_ed[df_ed$Year>=2010,c('Country','Year','EdInd')] %>%
  pivot_wider(names_from='Year',values_from="EdInd")
ggpairs(df[,c('2010','2011','2012','2013','2014','2015','2016','2017','2018')])


```


### Human Security Variable Selection

As noted in section 4, the Suicide rate data are collected sporadically.  While these datasets show the lowest proportion of missing data, they only show data for four years, which are not consistently spaced across time.

The other datasets in this section (Homicide rate, Prison population, and Homelessness due to natural disaster) show a higher proportion of missing data, but reflect a larger number of sampled years.

Additionally, while the Homelessness from natural disasters data appears to distort the proportion of missing values in the Human Security dataset, it remains a valuable factor in analysis.

Finally, as the Refugees by country of origin data is unavailable, it cannot be included in this analysis.

The following graph shows the pairwise correlation between all variables in the dataset, with the exception of Refugees by country of origin.


```{r,fig.height=8, fig.width = 8, warning = FALSE ,  message = FALSE}
Human.Security <- read_csv("./HumanSecurity/HumanSecurity.Final.Tidy.csv")
ggpairs(Human.Security[,c(3:7)], progress = FALSE,
        upper = list(continuous = wrap("cor", size = 4)),
        labeller = label_wrap_gen(10)) + 
      theme(strip.text = element_text(size = 8)) + 
      ggtitle("Pairwise Correlation Scatterplot Matrix", subtitle = "Human Security")

```

With the exception of male and female suicide rate (0.552), none of the data show correlation coefficients above 0.5 or below -0.5, indicating they are not highly correlated. 

As a result, the Human Security variables selected for this study are the following: 
* Homelessness from natural disaster
* Homicide rate
* Prison population


## Education versus Human Security (2010 - 2018)

For the actual analysis we compare the average across Education Index against the Human Security variables:

*Homelessness due to natural disaster
*Homicide rate
*Prison population 

```{r warning=FALSE, message=FALSE}
All<-read_csv('./FinalData/All.csv')
All<-All[All$Year>=2010,c("Country","EdInd",'Homeless.ND',  
                          'Homicide.rate','Prison.popn')]
EdHS<-All %>% group_by(Country) %>% select(everything()) %>%
  summarise_all(~mean(., na.rm = TRUE)) 
```

Here it looks like a high Education Index, is associated with a low Homicide rate, and prison population. The association between Education Index and Homicide is the clearest. Education and Prison population seems to show a similar relation, though a high education index seems to be associated more-so with a median level of Prison population, though several countries with high education levels, still seem to jump to higher prison populations. Interestingly, countries with high education are also closely associated with countries that have high homelessness due to natural disaster.

```{r}
ggparcoord(EdHS,scale = 'uniminmax',splineFactor = 5)  +
    theme(axis.text.x = element_text(angle = 0)) +
    xlab("") +
    ylab("") +
    ggtitle("Inequality versus Education Parallel Coordinate Plot")


```


The following scatterplot matrix makes the relationship even clearer, and intersting. Ranking high on the education index is highly correlated with Homelessness due to natural disaster. While higher levels of Education are still associated with low Homicide rates, where as if you restrict the analsysis to lower levels of education there seems to be an associated jump in high homicide outliers. The relationship between Education and prison population is somewhat stronger and direct as seen in the matrix-- with a correlation of 0.3 higher levels of education seem to imply higher levels of imprisonment.

```{r warning=FALSE, message=FALSE}

EdHS %>%
  ggpairs(columns = c("EdInd",'Homeless.ND',  
                          "Homicide.rate","Prison.popn"))


```


## Inequality versus Education (2010 - 2018)

This section will detail the analysis of `Inequality` versus `Education` indicators for features selected per the above:

`Inequality`

* Inequality-adjusted income index

* Inequality in income (%)

* Inequality in education (%)

* Inequality in life expectancy (%)

`Education`

* Education Index

* Mean Years of Schooling (Years)


```{r, warning = FALSE, message = FALSE}
education_df <- read_csv("./Education/Education_Tidy.csv") %>%
                  filter(Year %in% c(2010:2018)) %>%
                  select(Country, Year, EdInd, MYSch)
# education_df$Country[education_df$Country == 'Ivory Coast'] = "CÃ´te d'Ivoire"

inequal_ed <- inequality_df %>% 
  select(Country, Year, 
         'Inequality-adjusted income index', 
         'Inequality in income (%)', 
         'Inequality in education (%)',
         'Inequality in life expectancy (%)') %>%
  full_join(education_df, by = c('Country', 'Year'))

temp <- gsub(" ", "_", names(inequal_ed))
temp <- gsub("-", "_", temp)
temp <- gsub("\\(%\\)", "perc", temp)
names(inequal_ed) <-  temp

```


First, all `Inequality` variables were compared with all `Education` variables in a scatter plot, faceted by "Year" from 2010 to 2018 since those were the only years where `Inequality` data was available. It was noted that "Year" did not separate the data, as illustrated in the a sample facet plot below for "Mean Year of Schooling" versus "Inequality in life expectancy (%)". This was the case for every combination of variables. 

```{r, warning = FALSE, fig.height= 8, fig.width= 8}
inequal_ed %>%
  ggplot(aes(x = Inequality_in_life_expectancy_perc, y = MYSch)) +
  geom_point() +
  facet_wrap(~Year) +
  xlab('Inequality in Life Expectancy (%)') +
  ylab('Mean Years of Schooling (Years)') +
  ggtitle('Sample Plot of Inequality in Life Expectancy versus Mean Years of \nSchooling Faceted by Years') +
        theme(plot.title = element_text(size = 18))
```


Since there are 6 features in total all of which are continuous, a parallel coordinate plot is the most appropriate visualization tool for this type of data. For each of the six features, group by Country and average the data over all Years from 2010 to 2018 ignoring NA's. The rationale is as follows:

* It was shown from the facet plots previously that "Year" did not distinguish any trends.   

* If every Country-Year combination is a line on the parallel coordinate plot, then it would require that none of the six features have NA's. This is too strong and may lead to under plotting given the amount of missing data in this dataset. This also ensures that every country also shows up only once or not at all. 


```{r, fig.height = 7, fig.width=10}
inequal_ed[, c(1,2,6,4,3,5,7,8)] %>%
  group_by(Country) %>%
  summarise_all(~mean(., na.rm = TRUE)) %>%
  ungroup() %>%
  rename('Inequality in\nIncome (%)' = Inequality_in_income_perc, 
         "Inequality in \nEducation (%)" = Inequality_in_education_perc,
         "Inequality\nAdjusted \nIncome Index" = Inequality_adjusted_income_index,
         "Inequality in \nLife Expectancy\n(%)" = Inequality_in_life_expectancy_perc,
         'Education Index ' = EdInd,
         'Mean Years\nof Schooling\n(Years)' = MYSch) %>% 
  select(-Country, -Year) %>% 
  ggparcoord(alpha = 0.25,
               scale = 'uniminmax',
               splineFactor = 0)  +
    theme(axis.text.x = element_text(angle = 0)) +
    xlab("") +
    ylab("") +
    ggtitle("Inequality versus Education Parallel Coordinate Plot") +
        theme(plot.title = element_text(size = 18),
              axis.text.x = element_text(size = 12)) 
```

Observations:

* The two `Education` variables, "Education Index" and "Mean Years of Schooling", are positively correlated. Therefore, analysis for this section will be made with "Education Index" only because the same conclusions will apply to "Mean Years of Schooling".

* There is a large cluster of countries (call Cluster 1) with low "Inequality in Income (%)", mid to high "Inequality Adjusted Income Index", low "Inequality in Education (%)", and mid to high "Education Index". 

* For Cluster 1, there's a visible negative correlation between "Inequality in Education (%)" and "Education Index". 

* Since for Cluster 1 "Inequality Adjusted Income Index" is visibly negatively correlated with "Inequality in Education (%)", it can be inferred that the former is positively correlated with "Education Index". 

* There is another cluster of countries (call Cluster 2) exhibiting the opposite trend. This cluster of countries has low to mid "Inequality Adjusted Income Index", high "Inequality in Education (%)", and low-mid "Education Index".

* For countries in Cluster 2, there is no obvious negative correlation between "Inequality Adjusted Income Index" - "Education Index" and  "Inequality in Education (%)" - "Education Index" like in Cluster 1.

* Countries in Cluster 1 has a visible right skew in "Inequality in Education (%)" and a slight left skew in "Education Index", while countries in Cluster 2 exhibit no significant skew for these two features compared to Cluster 1. 



## Inequaity versus Human Security (2010 - 2018)

This section details the analysis of `Inequality` versus `Human Security` given the following variables:

`Inequality`

* Inequality-adjusted income index

* Inequality in income (%)

* Inequality in education (%)

* Inequality in life expectancy (%)

`Human Security`

* Homelessness due to natural disaster

* Homicide rate

* Prison population


```{r, warning = FALSE, message = FALSE}
HSINEQ_df <- read_csv("./FinalData/All.csv") %>%
                  filter(Year %in% c(2010:2018)) %>%
                  select(Country, Year, 'Inequality-adjusted income index', 'Inequality in income (%)', 'Inequality in education (%)', 'Inequality in life expectancy (%)', 'Homeless.ND', 'Homicide.rate', 'Prison.popn')

```


First, `Inequality` variables were contrasted against `Human Security` variables in a scatterplot, faceted by "Year" from 2010 to 2018 (again, the only years `Inequality` data were collected).

```{r, fig.height=8, fig.width=8, warning = FALSE}
ggpairs(HSINEQ_df[,c(3:9)], progress = FALSE,
        upper = list(continuous = wrap("cor", size = 4)),
        labeller = label_wrap_gen(10)) + 
      theme(strip.text = element_text(size = 8)) + 
      ggtitle("Pairwise Correlation Scatterplot Matrix", subtitle = "Inequality versus Human Security")
```
* The association between the 'Inequality' variables ("Inequality-adjusted income index", "Inequality in income", "Inequality in education", and "Inequality in life expectancy") is discussed in the Inequality variable selection, above.

* Similarly, the association between the 'Human Security' variables ("Homelessness due to natural disaster", "Homicide rate", and "Prison population") are discussed in the Human Security variable selection, above.

* "Prison population" shows low correlations with all 'Inequality' variables: "Inequality-adjusted income index" and "Inequality in income" show very low positive correlations (with correlation coefficients of .063 and .186, respectively), while "Inequality in education" and "Inequality in life expectancy" show low negative correlations (-0.276 and -0.240, respectively).

* "Homicide rate" shows low positive correlations with "Inequality in education" and "Inequality in life expectancy" (with correlation coefficients of 0.184 and 0.157).

* "Homicide rate" additionally shows notable correlations with "Inequality-adjusted income index", with a negative correlation of -0.375, and "Inequality in income", with a positive correlation of 0.492.

* Among the 'Human security' variables, "Homelessness due to natural disaster" shows the strongest correlations with 'Inequality' variables.  "Homelessness due to natural disaster" demonstrates a strong positive correlation with "Inequality-adjusted income" (0.907), and strong negative correlations with "Inequality in education" and "Inequality in life expectancy" (-0.820 and -0.914, respectively).  Finally, "Homelessness due to natural disaster" also shows a mid-strength negative correlation with "Inequality in income" (-0.339).

The parallel coordinate plots, below, map some of these associations.

```{r, fig.height = 7, fig.width=10}
HSINEQ_df %>%
  group_by(Country) %>%
  summarise_all(~mean(., na.rm = TRUE)) %>%
  ungroup() %>%
  rename("Inequality in \nEducation (%)" = `Inequality in education (%)`,
         "Inequality Adjusted \nIncome Index" = `Inequality-adjusted income index`,
         "Inequality in \nLife Expectancy (%)" = `Inequality in life expectancy (%)`,
         "Homelessness from \nNatural Disaster" = Homeless.ND,
         "Prison Population" = Prison.popn,
         "Homicide Rate" = Homicide.rate) %>% 
  select(-Country, -Year) %>% 
  ggparcoord(alpha = 0.25,
               scale = 'uniminmax',
               splineFactor = 0)  +
    theme(axis.text.x = element_text(angle = 0)) +
    xlab("") +
    ylab("") +
    ggtitle("Inequality versus Human Security Parallel Coordinate Plot")
```

Some observations:

* A cluster of countries (Cluster 1) shows a negative correlation between "Inequality adjusted income" and "Inequality in income", with high "Inequality adjusted income" and low "Inequality in income".

* Another cluster (Cluster 2) shows low "Inequality in life expectancy", high "Homelessness from natural disaster", and low "Homicide rate".  Cluster 2 shows a visible positive correlation between "Inequality in life expectancy" 

* Cluster 4: Homicide rate and Prison popn




```{r, fig.height = 7, fig.width=10}
HSINEQ_df[, c(1,2,5,8,3,9,6,7)] %>%
  group_by(Country) %>%
  summarise_all(~mean(., na.rm = TRUE)) %>%
  ungroup() %>%
  rename("Inequality in \nEducation (%)" = `Inequality in education (%)`,
         "Homicide Rate" = Homicide.rate,
         "Inequality Adjusted \nIncome Index" = `Inequality-adjusted income index`,
         "Prison Population" = Prison.popn,
         "Inequality in \nLife Expectancy (%)" = `Inequality in life expectancy (%)`,
         "Homelessness from \nNatural Disaster" = Homeless.ND) %>% 
  select(-Country, -Year) %>% 
  ggparcoord(alpha = 0.25,
               scale = 'uniminmax',
               splineFactor = 0)  +
    theme(axis.text.x = element_text(angle = 0)) +
    xlab("") +
    ylab("") +
    ggtitle("Inequality versus Human Security Parallel Coordinate Plot")
```



To look at our data more closely in our interactive component we create a finalized csv to be read into our plot.

```{r, warning=FALSE, message=FALSE}

All<-read_csv('./FinalData/All.csv')
All<-All[All$Year>=2010,c("Country","EdInd",'Homeless.ND',  
                          'Homicide.rate','Prison.popn',
                          'Inequality-adjusted income index', 'Inequality in income (%)', 
                          'Inequality in education (%)', 'Inequality in life expectancy (%)')]
AvgAll<-All %>% group_by(Country) %>% select(everything()) %>%
  summarise_all(~mean(., na.rm = TRUE))
AvgAll %>% write_csv("./Interactive/HumDevAll.csv")


```

